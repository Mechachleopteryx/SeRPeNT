#include <diffproc/npstats.h>


/*
 * Mann-Whitney U test critical values table for alpha = 0.01. One-tailed.
 */
double MWUL[20][20] = {
  //  1    2    3    4    5    6    7    8    9   10   11   12   13   14   15   16   17   18   19   20
  {  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1}, //  1
  {  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,   0,   0,   0,   0,   0,   0,   1,   1}, //  2
  {  -1,  -1,  -1,  -1,  -1,  -1,   0,   0,   1,   1,   1,   2,   2,   2,   3,   3,   4,   4,   4,   5}, //  3
  {  -1,  -1,  -1,  -1,   0,   1,   1,   2,   3,   3,   4,   5,   5,   6,   7,   7,   8,   9,   9,  10}, //  4
  {  -1,  -1,  -1,   0,   1,   2,   3,   4,   5,   6,   7,   8,   9,  10,  11,  12,  13,  14,  15,  16}, //  5
  {  -1,  -1,  -1,   1,   2,   3,   4,   6,   7,   8,   9,  11,  12,  13,  15,  16,  18,  19,  20,  22}, //  6
  {  -1,  -1,   0,   1,   3,   4,   6,   7,   9,  11,  12,  14,  16,  17,  19,  21,  23,  24,  26,  28}, //  7
  {  -1,  -1,   0,   2,   4,   6,   7,   9,  11,  13,  15,  17,  20,  22,  24,  26,  28,  30,  32,  34}, //  8
  {  -1,  -1,   1,   3,   5,   7,   9,  11,  14,  16,  18,  21,  23,  26,  28,  31,  33,  36,  38,  40}, //  9
  {  -1,  -1,   1,   3,   6,   8,  11,  13,  16,  19,  22,  24,  27,  30,  33,  36,  38,  41,  44,  47}, // 10
  {  -1,  -1,   1,   4,   7,   9,  12,  15,  18,  22,  25,  28,  31,  34,  37,  41,  44,  47,  50,  53}, // 11
  {  -1,  -1,   2,   5,   8,  11,  14,  17,  21,  24,  28,  31,  35,  38,  42,  46,  49,  53,  56,  60}, // 12
  {  -1,   0,   2,   5,   9,  12,  16,  20,  23,  27,  31,  35,  39,  43,  47,  51,  55,  59,  63,  67}, // 13
  {  -1,   0,   2,   6,  10,  13,  17,  22,  26,  30,  34,  38,  43,  47,  51,  56,  60,  65,  69,  73}, // 14
  {  -1,   0,   3,   7,  11,  15,  19,  24,  28,  33,  37,  42,  47,  51,  56,  61,  66,  70,  75,  80}, // 15
  {  -1,   0,   3,   7,  12,  16,  21,  26,  31,  36,  41,  46,  51,  56,  61,  66,  71,  76,  82,  87}, // 16
  {  -1,   0,   4,   8,  13,  18,  23,  28,  33,  38,  44,  49,  55,  60,  66,  71,  77,  82,  88,  93}, // 17
  {  -1,   0,   4,   9,  14,  19,  24,  30,  36,  41,  47,  53,  59,  65,  70,  76,  82,  88,  94, 100}, // 18
  {  -1,   1,   4,   9,  15,  20,  26,  32,  38,  44,  50,  56,  63,  69,  75,  82,  88,  94, 101, 107}, // 19
  {  -1,   1,   5,  10,  16,  22,  28,  34,  40,  47,  53,  60,  67,  73,  80,  87,  93, 100, 107, 114}  // 20
};


/*
 * Mann-Whitney U test critical values table for alpha = 0.05. One-tailed.
 */
double MWUH[20][20] = {
  //  1    2    3    4    5    6    7    8    9   10   11   12   13   14   15   16   17   18   19   20
  {  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,   0}, //  1
  {  -1,  -1,  -1,  -1,   0,   0,   0,   1,   1,   1,   1,   2,   2,   2,   3,   3,   3,   4,   4,   4}, //  2
  {  -1,  -1,  -1,   0,   1,   2,   2,   3,   3,   4,   5,   5,   6,   7,   7,   8,   9,   9,  10,  11}, //  3
  {  -1,  -1,   0,   1,   2,   3,   4,   5,   6,   7,   8,   9,  10,  11,  12,  14,  15,  16,  17,  18}, //  4
  {  -1,   0,   1,   2,   4,   5,   6,   8,   9,  11,  12,  13,  15,  16,  18,  19,  20,  22,  23,  25}, //  5
  {  -1,   0,   2,   3,   5,   7,   8,  10,  12,  14,  16,  17,  19,  21,  23,  25,  26,  28,  30,  32}, //  6
  {  -1,   0,   2,   4,   6,   8,  11,  13,  15,  17,  19,  21,  24,  26,  28,  30,  33,  35,  37,  39}, //  7
  {  -1,   1,   3,   5,   8,  10,  13,  15,  18,  20,  23,  26,  28,  31,  33,  36,  39,  41,  44,  47}, //  8
  {  -1,   1,   3,   6,   9,  12,  15,  18,  21,  24,  27,  30,  33,  36,  39,  42,  45,  48,  51,  54}, //  9
  {  -1,   1,   4,   7,  11,  14,  17,  20,  24,  27,  31,  34,  37,  41,  44,  48,  51,  55,  58,  62}, // 10
  {  -1,   1,   5,   8,  12,  16,  19,  23,  27,  31,  34,  38,  42,  46,  50,  54,  57,  61,  65,  69}, // 11
  {  -1,   2,   5,   9,  13,  17,  21,  26,  30,  34,  38,  42,  47,  51,  55,  60,  64,  68,  72,  77}, // 12
  {  -1,   2,   6,  10,  15,  19,  24,  28,  33,  37,  42,  47,  51,  56,  61,  65,  70,  75,  80,  84}, // 13
  {  -1,   2,   7,  11,  16,  21,  26,  31,  36,  41,  46,  51,  56,  61,  66,  71,  77,  82,  87,  92}, // 14
  {  -1,   3,   7,  12,  18,  23,  28,  33,  39,  44,  50,  55,  61,  66,  72,  77,  83,  88,  94, 100}, // 15
  {  -1,   3,   8,  14,  19,  25,  30,  36,  42,  48,  54,  60,  65,  71,  77,  83,  89,  95, 101, 107}, // 16
  {  -1,   3,   9,  15,  20,  26,  33,  39,  45,  51,  57,  64,  70,  77,  83,  89,  96, 102, 109, 115}, // 17
  {  -1,   4,   9,  16,  22,  28,  35,  41,  48,  55,  61,  68,  75,  82,  88,  95, 102, 109, 116, 123}, // 18
  {  -1,   4,  10,  17,  23,  30,  37,  44,  51,  58,  65,  72,  80,  87,  94, 101, 109, 116, 123, 130}, // 19
  {   0,   4,  11,  18,  25,  32,  39,  47,  54,  62,  69,  77,  84,  92, 100, 107, 115, 123, 130, 138}  // 20
};


/*
 * Z-Score Table
 *
 * From (-9.99) to 0
 */
double ZSCORE[1000] = {
  8.429087e-24, 9.323339e-24, 1.031144e-23, 1.140314e-23, 1.260916e-23, 1.394136e-23, 1.541278e-23, 1.703781e-23, 1.883231e-23,
  2.081375e-23, 2.300140e-23, 2.541645e-23, 2.808231e-23, 3.102470e-23, 3.427199e-23, 3.785542e-23, 4.180939e-23, 4.617177e-23,
  5.098428e-23, 5.629282e-23, 6.214794e-23, 6.860527e-23, 7.572604e-23, 8.357761e-23, 9.223414e-23, 1.017772e-22, 1.122965e-22,
  1.238907e-22, 1.366686e-22, 1.507493e-22, 1.662643e-22, 1.833580e-22, 2.021890e-22, 2.229320e-22, 2.457786e-22, 2.709399e-22,
  2.986474e-22, 3.291558e-22, 3.627449e-22, 3.997221e-22, 4.404251e-22, 4.852247e-22, 5.345284e-22, 5.887835e-22, 6.484814e-22,
  7.141616e-22, 7.864161e-22, 8.658953e-22, 9.533127e-22, 1.049452e-21, 1.155171e-21, 1.271415e-21, 1.399218e-21, 1.539716e-21,
  1.694154e-21, 1.863897e-21, 2.050445e-21, 2.255440e-21, 2.480685e-21, 2.728154e-21, 3.000013e-21, 3.298636e-21, 3.626626e-21,
  3.986835e-21, 4.382386e-21, 4.816706e-21, 5.293545e-21, 5.817015e-21, 6.391617e-21, 7.022284e-21, 7.714416e-21, 8.473928e-21,
  9.307296e-21, 1.022161e-20, 1.122463e-20, 1.232486e-20, 1.353160e-20, 1.485501e-20, 1.630625e-20, 1.789749e-20, 1.964207e-20,
  2.155457e-20, 2.365095e-20, 2.594866e-20, 2.846677e-20, 3.122617e-20, 3.424965e-20, 3.756216e-20, 4.119099e-20, 4.516591e-20,
  4.951953e-20, 5.428743e-20, 5.950851e-20, 6.522528e-20, 7.148417e-20, 7.833591e-20, 8.583590e-20, 9.404465e-20, 1.030282e-19,
  1.128588e-19, 1.236152e-19, 1.353834e-19, 1.482572e-19, 1.623392e-19, 1.777412e-19, 1.945852e-19, 2.130044e-19, 2.331441e-19,
  2.551628e-19, 2.792334e-19, 3.055445e-19, 3.343018e-19, 3.657295e-19, 4.000722e-19, 4.375965e-19, 4.785930e-19, 5.233786e-19,
  5.722986e-19, 6.257293e-19, 6.840808e-19, 7.477998e-19, 8.173733e-19, 8.933314e-19, 9.762519e-19, 1.066764e-18, 1.165552e-18,
  1.273363e-18, 1.391009e-18, 1.519374e-18, 1.659421e-18, 1.812197e-18, 1.978844e-18, 2.160602e-18, 2.358821e-18, 2.574972e-18,
  2.810651e-18, 3.067599e-18, 3.347706e-18, 3.653029e-18, 3.985805e-18, 4.348466e-18, 4.743657e-18, 5.174252e-18, 5.643376e-18,
  6.154426e-18, 6.711092e-18, 7.317386e-18, 7.977666e-18, 8.696668e-18, 9.479535e-18, 1.033185e-17, 1.125970e-17, 1.226965e-17,
  1.336888e-17, 1.456514e-17, 1.586688e-17, 1.728326e-17, 1.882422e-17, 2.050054e-17, 2.232393e-17, 2.430711e-17, 2.646385e-17,
  2.880912e-17, 3.135913e-17, 3.413148e-17, 3.714527e-17, 4.042118e-17, 4.398166e-17, 4.785104e-17, 5.205570e-17, 5.662423e-17,
  6.158764e-17, 6.697951e-17, 7.283623e-17, 7.919726e-17, 8.610533e-17, 9.360672e-17, 1.017516e-16, 1.105942e-16, 1.201935e-16,
  1.306131e-16, 1.419219e-16, 1.541947e-16, 1.675123e-16, 1.819621e-16, 1.976389e-16, 2.146452e-16, 2.330918e-16, 2.530988e-16,
  2.747959e-16, 2.983237e-16, 3.238339e-16, 3.514908e-16, 3.814722e-16, 4.139702e-16, 4.491924e-16, 4.873633e-16, 5.287258e-16,
  5.735422e-16, 6.220961e-16, 6.746938e-16, 7.316665e-16, 7.933718e-16, 8.601964e-16, 9.325576e-16, 1.010906e-15, 1.095729e-15,
  1.187553e-15, 1.286944e-15, 1.394517e-15, 1.510933e-15, 1.636905e-15, 1.773206e-15, 1.920667e-15, 2.080186e-15, 2.252732e-15,
  2.439350e-15, 2.641167e-15, 2.859399e-15, 3.095359e-15, 3.350460e-15, 3.626227e-15, 3.924306e-15, 4.246469e-15, 4.594627e-15,
  4.970841e-15, 5.377329e-15, 5.816485e-15, 6.290887e-15, 6.803312e-15, 7.356751e-15, 7.954429e-15, 8.599817e-15, 9.296654e-15,
  1.004897e-14, 1.086109e-14, 1.173769e-14, 1.268379e-14, 1.370480e-14, 1.480654e-14, 1.599527e-14, 1.727775e-14, 1.866121e-14,
  2.015347e-14, 2.176291e-14, 2.349857e-14, 2.537016e-14, 2.738812e-14, 2.956368e-14, 3.190892e-14, 3.443681e-14, 3.716131e-14,
  4.009741e-14, 4.326124e-14, 4.667012e-14, 5.034265e-14, 5.429884e-14, 5.856017e-14, 6.314971e-14, 6.809225e-14, 7.341441e-14,
  7.914477e-14, 8.531402e-14, 9.195511e-14, 9.910343e-14, 1.067969e-13, 1.150764e-13, 1.239855e-13, 1.335712e-13, 1.438839e-13,
  1.549775e-13, 1.669101e-13, 1.797437e-13, 1.935452e-13, 2.083858e-13, 2.243424e-13, 2.414970e-13, 2.599379e-13, 2.797594e-13,
  3.010628e-13, 3.239566e-13, 3.485571e-13, 3.749888e-13, 4.033853e-13, 4.338895e-13, 4.666546e-13, 5.018446e-13, 5.396353e-13,
  5.802148e-13, 6.237844e-13, 6.705600e-13, 7.207723e-13, 7.746685e-13, 8.325130e-13, 8.945890e-13, 9.611992e-13, 1.032668e-12,
  1.109341e-12, 1.191591e-12, 1.279813e-12, 1.374431e-12, 1.475900e-12, 1.584705e-12, 1.701364e-12, 1.826431e-12, 1.960500e-12,
  2.104203e-12, 2.258218e-12, 2.423269e-12, 2.600127e-12, 2.789619e-12, 2.992628e-12, 3.210095e-12, 3.443027e-12, 3.692499e-12,
  3.959659e-12, 4.245732e-12, 4.552026e-12, 4.879937e-12, 5.230958e-12, 5.606677e-12, 6.008794e-12, 6.439120e-12, 6.899587e-12,
  7.392258e-12, 7.919332e-12, 8.483154e-12, 9.086228e-12, 9.731221e-12, 1.042098e-11, 1.115853e-11, 1.194711e-11, 1.279017e-11,
  1.369138e-11, 1.465465e-11, 1.568416e-11, 1.678434e-11, 1.795994e-11, 1.921600e-11, 2.055789e-11, 2.199133e-11, 2.352241e-11,
  2.515763e-11, 2.690389e-11, 2.876854e-11, 3.075942e-11, 3.288485e-11, 3.515370e-11, 3.757540e-11, 4.016001e-11, 4.291819e-11,
  4.586131e-11, 4.900146e-11, 5.235149e-11, 5.592508e-11, 5.973675e-11, 6.380197e-11, 6.813717e-11, 7.275982e-11, 7.768848e-11,
  8.294288e-11, 8.854399e-11, 9.451410e-11, 1.008769e-10, 1.076575e-10, 1.148826e-10, 1.225806e-10, 1.307817e-10, 1.395177e-10,
  1.488228e-10, 1.587330e-10, 1.692865e-10, 1.805241e-10, 1.924887e-10, 2.052263e-10, 2.187854e-10, 2.332176e-10, 2.485774e-10,
  2.649230e-10, 2.823158e-10, 3.008211e-10, 3.205080e-10, 3.414500e-10, 3.637247e-10, 3.874147e-10, 4.126074e-10, 4.393954e-10,
  4.678768e-10, 4.981557e-10, 5.303423e-10, 5.645534e-10, 6.009127e-10, 6.395513e-10, 6.806077e-10, 7.242292e-10, 7.705711e-10,
  8.197984e-10, 8.720854e-10, 9.276166e-10, 9.865876e-10, 1.049205e-09, 1.115688e-09, 1.186268e-09, 1.261190e-09, 1.340712e-09,
  1.425110e-09, 1.514673e-09, 1.609708e-09, 1.710539e-09, 1.817508e-09, 1.930978e-09, 2.051332e-09, 2.178976e-09, 2.314336e-09,
  2.457865e-09, 2.610041e-09, 2.771369e-09, 2.942381e-09, 3.123642e-09, 3.315746e-09, 3.519321e-09, 3.735031e-09, 3.963577e-09,
  4.205697e-09, 4.462172e-09, 4.733828e-09, 5.021532e-09, 5.326203e-09, 5.648809e-09, 5.990371e-09, 6.351969e-09, 6.734737e-09,
  7.139876e-09, 7.568650e-09, 8.022392e-09, 8.502508e-09, 9.010481e-09, 9.547873e-09, 1.011633e-08, 1.071759e-08, 1.135348e-08,
  1.202593e-08, 1.273697e-08, 1.348873e-08, 1.428348e-08, 1.512358e-08, 1.601154e-08, 1.694998e-08, 1.794168e-08, 1.898956e-08,
  2.009669e-08, 2.126629e-08, 2.250178e-08, 2.380673e-08, 2.518491e-08, 2.664029e-08, 2.817703e-08, 2.979952e-08, 3.151237e-08,
  3.332045e-08, 3.522884e-08, 3.724292e-08, 3.936832e-08, 4.161098e-08, 4.397712e-08, 4.647329e-08, 4.910638e-08, 5.188363e-08,
  5.481262e-08, 5.790134e-08, 6.115818e-08, 6.459194e-08, 6.821188e-08, 7.202770e-08, 7.604961e-08, 8.028830e-08, 8.475502e-08,
  8.946157e-08, 9.442032e-08, 9.964426e-08, 1.051470e-07, 1.109430e-07, 1.170470e-07, 1.234749e-07, 1.302432e-07, 1.373692e-07,
  1.448711e-07, 1.527678e-07, 1.610794e-07, 1.698267e-07, 1.790318e-07, 1.887174e-07, 1.989079e-07, 2.096282e-07, 2.209050e-07,
  2.327659e-07, 2.452399e-07, 2.583574e-07, 2.721502e-07, 2.866516e-07, 3.018965e-07, 3.179214e-07, 3.347645e-07, 3.524659e-07,
  3.710674e-07, 3.906129e-07, 4.111481e-07, 4.327211e-07, 4.553820e-07, 4.791833e-07, 5.041799e-07, 5.304292e-07, 5.579912e-07,
  5.869288e-07, 6.173074e-07, 6.491956e-07, 6.826653e-07, 7.177911e-07, 7.546515e-07, 7.933282e-07, 8.339066e-07, 8.764760e-07,
  9.211296e-07, 9.679648e-07, 1.017083e-06, 1.068591e-06, 1.122599e-06, 1.179223e-06, 1.238584e-06, 1.300807e-06, 1.366025e-06,
  1.434375e-06, 1.505999e-06, 1.581047e-06, 1.659675e-06, 1.742046e-06, 1.828329e-06, 1.918700e-06, 2.013345e-06, 2.112455e-06,
  2.216230e-06, 2.324880e-06, 2.438621e-06, 2.557681e-06, 2.682296e-06, 2.812711e-06, 2.949184e-06, 3.091982e-06, 3.241381e-06,
  3.397673e-06, 3.561159e-06, 3.732152e-06, 3.910980e-06, 4.097983e-06, 4.293514e-06, 4.497944e-06, 4.711654e-06, 4.935045e-06,
  5.168531e-06, 5.412544e-06, 5.667533e-06, 5.933965e-06, 6.212327e-06, 6.503122e-06, 6.806877e-06, 7.124136e-06, 7.455467e-06,
  7.801460e-06, 8.162727e-06, 8.539905e-06, 8.933656e-06, 9.344666e-06, 9.773648e-06, 1.022135e-05, 1.068853e-05, 1.117599e-05,
  1.168457e-05, 1.221512e-05, 1.276853e-05, 1.334575e-05, 1.394772e-05, 1.457545e-05, 1.522998e-05, 1.591238e-05, 1.662376e-05,
  1.736529e-05, 1.813816e-05, 1.894362e-05, 1.978296e-05, 2.065751e-05, 2.156866e-05, 2.251785e-05, 2.350657e-05, 2.453636e-05,
  2.560882e-05, 2.672560e-05, 2.788843e-05, 2.909907e-05, 3.035937e-05, 3.167124e-05, 3.303665e-05, 3.445763e-05, 3.593632e-05,
  3.747488e-05, 3.907560e-05, 4.074080e-05, 4.247293e-05, 4.427448e-05, 4.614806e-05, 4.809634e-05, 5.012211e-05, 5.222823e-05,
  5.441768e-05, 5.669351e-05, 5.905891e-05, 6.151716e-05, 6.407163e-05, 6.672584e-05, 6.948340e-05, 7.234804e-05, 7.532364e-05,
  7.841418e-05, 8.162377e-05, 8.495668e-05, 8.841729e-05, 9.201013e-05, 9.573989e-05, 9.961139e-05, 1.036296e-04, 1.077997e-04,
  1.121270e-04, 1.166170e-04, 1.212752e-04, 1.261076e-04, 1.311202e-04, 1.363190e-04, 1.417106e-04, 1.473015e-04, 1.530985e-04,
  1.591086e-04, 1.653390e-04, 1.717971e-04, 1.784906e-04, 1.854274e-04, 1.926156e-04, 2.000635e-04, 2.077798e-04, 2.157734e-04,
  2.240533e-04, 2.326291e-04, 2.415103e-04, 2.507069e-04, 2.602292e-04, 2.700877e-04, 2.802933e-04, 2.908571e-04, 3.017906e-04,
  3.131057e-04, 3.248144e-04, 3.369293e-04, 3.494631e-04, 3.624291e-04, 3.758409e-04, 3.897124e-04, 4.040578e-04, 4.188919e-04,
  4.342299e-04, 4.500872e-04, 4.664799e-04, 4.834241e-04, 5.009369e-04, 5.190354e-04, 5.377374e-04, 5.570611e-04, 5.770250e-04,
  5.976485e-04, 6.189511e-04, 6.409530e-04, 6.636749e-04, 6.871379e-04, 7.113640e-04, 7.363753e-04, 7.621947e-04, 7.888457e-04,
  8.163523e-04, 8.447392e-04, 8.740315e-04, 9.042552e-04, 9.354367e-04, 9.676032e-04, 1.000782e-03, 1.035003e-03, 1.070294e-03,
  1.106685e-03, 1.144207e-03, 1.182891e-03, 1.222769e-03, 1.263873e-03, 1.306238e-03, 1.349898e-03, 1.394887e-03, 1.441242e-03,
  1.488999e-03, 1.538195e-03, 1.588870e-03, 1.641061e-03, 1.694810e-03, 1.750157e-03, 1.807144e-03, 1.865813e-03, 1.926209e-03,
  1.988376e-03, 2.052359e-03, 2.118205e-03, 2.185961e-03, 2.255677e-03, 2.327400e-03, 2.401182e-03, 2.477075e-03, 2.555130e-03,
  2.635402e-03, 2.717945e-03, 2.802815e-03, 2.890068e-03, 2.979763e-03, 3.071959e-03, 3.166716e-03, 3.264096e-03, 3.364160e-03,
  3.466974e-03, 3.572601e-03, 3.681108e-03, 3.792562e-03, 3.907033e-03, 4.024589e-03, 4.145301e-03, 4.269243e-03, 4.396488e-03,
  4.527111e-03, 4.661188e-03, 4.798797e-03, 4.940016e-03, 5.084926e-03, 5.233608e-03, 5.386146e-03, 5.542623e-03, 5.703126e-03,
  5.867742e-03, 6.036558e-03, 6.209665e-03, 6.387155e-03, 6.569119e-03, 6.755653e-03, 6.946851e-03, 7.142811e-03, 7.343631e-03,
  7.549411e-03, 7.760254e-03, 7.976260e-03, 8.197536e-03, 8.424186e-03, 8.656319e-03, 8.894043e-03, 9.137468e-03, 9.386706e-03,
  9.641870e-03, 9.903076e-03, 1.017044e-02, 1.044408e-02, 1.072411e-02, 1.101066e-02, 1.130384e-02, 1.160379e-02, 1.191063e-02,
  1.222447e-02, 1.254546e-02, 1.287372e-02, 1.320938e-02, 1.355258e-02, 1.390345e-02, 1.426212e-02, 1.462873e-02, 1.500342e-02,
  1.538633e-02, 1.577761e-02, 1.617738e-02, 1.658581e-02, 1.700302e-02, 1.742918e-02, 1.786442e-02, 1.830890e-02, 1.876277e-02,
  1.922617e-02, 1.969927e-02, 2.018222e-02, 2.067516e-02, 2.117827e-02, 2.169169e-02, 2.221559e-02, 2.275013e-02, 2.329547e-02,
  2.385176e-02, 2.441919e-02, 2.499790e-02, 2.558806e-02, 2.618984e-02, 2.680342e-02, 2.742895e-02, 2.806661e-02, 2.871656e-02,
  2.937898e-02, 3.005404e-02, 3.074191e-02, 3.144276e-02, 3.215677e-02, 3.288412e-02, 3.362497e-02, 3.437950e-02, 3.514789e-02,
  3.593032e-02, 3.672696e-02, 3.753798e-02, 3.836357e-02, 3.920390e-02, 4.005916e-02, 4.092951e-02, 4.181514e-02, 4.271622e-02,
  4.363294e-02, 4.456546e-02, 4.551398e-02, 4.647866e-02, 4.745968e-02, 4.845723e-02, 4.947147e-02, 5.050258e-02, 5.155075e-02,
  5.261614e-02, 5.369893e-02, 5.479929e-02, 5.591740e-02, 5.705343e-02, 5.820756e-02, 5.937994e-02, 6.057076e-02, 6.178018e-02,
  6.300836e-02, 6.425549e-02, 6.552171e-02, 6.680720e-02, 6.811212e-02, 6.943662e-02, 7.078088e-02, 7.214504e-02, 7.352926e-02,
  7.493370e-02, 7.635851e-02, 7.780384e-02, 7.926984e-02, 8.075666e-02, 8.226444e-02, 8.379332e-02, 8.534345e-02, 8.691496e-02,
  8.850799e-02, 9.012267e-02, 9.175914e-02, 9.341751e-02, 9.509792e-02, 9.680048e-02, 9.852533e-02, 1.002726e-01, 1.020423e-01,
  1.038347e-01, 1.056498e-01, 1.074877e-01, 1.093486e-01, 1.112324e-01, 1.131394e-01, 1.150697e-01, 1.170232e-01, 1.190001e-01,
  1.210005e-01, 1.230244e-01, 1.250719e-01, 1.271432e-01, 1.292381e-01, 1.313569e-01, 1.334995e-01, 1.356661e-01, 1.378566e-01,
  1.400711e-01, 1.423097e-01, 1.445723e-01, 1.468591e-01, 1.491700e-01, 1.515050e-01, 1.538642e-01, 1.562476e-01, 1.586553e-01,
  1.610871e-01, 1.635431e-01, 1.660232e-01, 1.685276e-01, 1.710561e-01, 1.736088e-01, 1.761855e-01, 1.787864e-01, 1.814113e-01,
  1.840601e-01, 1.867329e-01, 1.894297e-01, 1.921502e-01, 1.948945e-01, 1.976625e-01, 2.004542e-01, 2.032694e-01, 2.061081e-01,
  2.089701e-01, 2.118554e-01, 2.147639e-01, 2.176954e-01, 2.206499e-01, 2.236273e-01, 2.266274e-01, 2.296500e-01, 2.326951e-01,
  2.357625e-01, 2.388521e-01, 2.419637e-01, 2.450971e-01, 2.482522e-01, 2.514289e-01, 2.546269e-01, 2.578461e-01, 2.610863e-01,
  2.643473e-01, 2.676289e-01, 2.709309e-01, 2.742531e-01, 2.775953e-01, 2.809573e-01, 2.843388e-01, 2.877397e-01, 2.911597e-01,
  2.945985e-01, 2.980560e-01, 3.015318e-01, 3.050257e-01, 3.085375e-01, 3.120669e-01, 3.156137e-01, 3.191775e-01, 3.227581e-01,
  3.263552e-01, 3.299686e-01, 3.335978e-01, 3.372427e-01, 3.409030e-01, 3.445783e-01, 3.482683e-01, 3.519727e-01, 3.556912e-01,
  3.594236e-01, 3.631693e-01, 3.669283e-01, 3.707000e-01, 3.744842e-01, 3.782805e-01, 3.820886e-01, 3.859081e-01, 3.897388e-01,
  3.935801e-01, 3.974319e-01, 4.012937e-01, 4.051651e-01, 4.090459e-01, 4.129356e-01, 4.168338e-01, 4.207403e-01, 4.246546e-01,
  4.285763e-01, 4.325051e-01, 4.364405e-01, 4.403823e-01, 4.443300e-01, 4.482832e-01, 4.522416e-01, 4.562047e-01, 4.601722e-01,
  4.641436e-01, 4.681186e-01, 4.720968e-01, 4.760778e-01, 4.800612e-01, 4.840466e-01, 4.880335e-01, 4.920217e-01, 4.960106e-01,
  5.000000e-01
};


/*
 * cmpnp
 *   Comparison function to sort npstats_struct objects
 */
int cmpnp (const void *x, const void *y)
{
  npstats_struct xx = *(npstats_struct*) x;
  npstats_struct yy = *(npstats_struct*) y;

  if (xx.value < yy.value) return -1;
  if (xx.value > yy.value) return 1;
  return 0;
}

/*
 * ztop
 *   Convert z-score to p-value
 *
 * p = 2*pnorm(-abs(z))
 *
 * @arg double z 
 *   z-score
 * 
 * @return
 *   p-value
 */
double ztop (double z)
{
  int idx = (int) (sqrt(z*z) * 100.0f + 0.5f);
  if (idx > 999) idx = 999;
  idx = 999 - idx;
  return (2 * ZSCORE[idx]);
}


/*
 * mannwhitney_d
 *
 * @see include/annotate/npstats.h
 */
int mannwhitney_d (double* p, int n, double* q, int m, double pval)
{
  double up;
  int i, j;

  // Calculate Up
  up = 0;
  for (i = 0; i < n; i++) {
    for (j = 0; j < m; j++) {
      if (p[i] > q[j]) up += 1.0f;
      else if (p[i] == q[j]) up += 0.5f;
    }
  }
fprintf(stderr, "%f\n", up);
  // Check critical value tables and rehect H0 if U <= Ucritical
  if ((pval <= 0.0100001) && (up <= MWUL[n - 1][m - 1]))  // Floating point issues
    return(1);
  if ((pval >= 0.0499999) && (up <= MWUH[n - 1][m - 1]))  // Floating point issues
    return(1);

  return(0);
}


/*
 * mannwhitney_i
 *
 * @see include/annotate/npstats.h
 */
int mannwhitney_i (double* p, int n, double* q, int m, double pval)
{
  npstats_struct* all;
  int i, j, idx;
  double u, z, r, nd, md, mu, sd;

  // Merge all observations from samples p and q and sort
  all = (npstats_struct*) malloc((n + m) * sizeof(npstats_struct));
  idx = 0;
  for (i = 0; i < n; i++) {
    all[idx].value = p[i];
    all[idx].sample = 1;
    idx++;
  }
  for (i = 0; i < m; i++) {
    all[idx].value = q[i];
    all[idx].sample = 2;
    idx++;
  }
  qsort(all, n + m, sizeof(npstats_struct), cmpnp);

  // Correct for ties by adjusting ranks
  for (i = 0; i < n + m; i++)
    all[i].adjidx = (double) (i + 1);
  for (i = 0; i < n + m; i++) {
    int start = i;
    int end = i;
    while((end < (n + m)) && (all[start].value == all[end].value)) end++;
    end--;
    if (end != start) {
      for (j = start; j <= end; j++)
        all[j].adjidx = (start + 1) + ((end + 1) - (start + 1)) / 2.0;
      i = end;
    }
  }

  // Calculate U
  r = 0.0f;
  for (i = 0; i < n + m; i++) {
    if (all[i].sample == 1)
      r += all[i].adjidx;
  }
  nd = (double) n;
  md = (double) m;
  u = r - ((nd * (nd + 1)) / 2);

  // Calculate Z
  mu = (md * nd) / 2.0f;
  sd = sqrt((md * nd * (md + nd + 1.0f)) / 12);
  z = (u - mu) / sd;

  // Return
  free(all);
  if (ztop(z) <= pval)
    return(1);
  return(0);
}

/*
 * mannwhitney_a
 *
 * @see include/diffproc/npstats.h
 */
int mannwhitney_a (int n, int m, double pval)
{
  int ni = n;
  int mi = m;

  if (ni == 0 || mi == 0)
    return 0;

  if (n > 20) ni = 20;
  if (m > 20) mi = 20;

  if (pval >= 0.0499999 && MWUH[ni - 1][mi - 1] >= 0)  // floating point issues
    return 1;

  if (pval <= 0.0100001 && MWUL[ni - 1][mi - 1] >= 0) // floating point issues
    return 1;

  return 0;
}
